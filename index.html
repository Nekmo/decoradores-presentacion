
<!DOCTYPE html>

<html lang="es">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

  <title>Todo sobre los decoradores</title>
    <link rel="stylesheet" type="text/css" href="_static/revealjs4/dist/reveal.css" />
    <link rel="stylesheet" href="_static/revealjs4/dist/theme/.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/theme.css" />
    <script src="_static/main.js"></script>
    <link rel="next" title="Todo sobre los decoradores de Python" href="README.html" />
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

  </head><body>
    <div class="reveal">
        <div class="slides" role="main">
            <div class="toctree-wrapper compound">
</div>
<section data-background-color="#333333" data-transition="none" data-transition-speed="slow" id="intro">
<h1>Todo sobre los <strong>decoradores</strong></h1>
<a class="reference internal image-reference" href="_images/python-logo.png"><img alt="_images/python-logo.png" src="_images/python-logo.png" style="width: 200px;" /></a>
<aside class="notes">Hola a todos.</aside></section>
<section data-background-color="#4973ff" data-transition-speed="slow" data-transition="fade" id="id1">
<h2>üëã</h2>
<aside class="notes">Quiero dar ante todo las gracias a la organizaci√≥n por estar un a√±o m√°s aqu√≠ con todos vosotros.</aside></section>
<section data-background-color="#4973ff" data-transition-speed="default" data-transition="fade" id="opensouthcode">
<h2>OpenSouthCode</h2>
<a class="reference internal image-reference" href="_images/opensouthcode-logo-white.png"><img alt="_images/opensouthcode-logo-white.png" src="_images/opensouthcode-logo-white.png" style="width: 800px;" /></a>
<aside class="notes">Son ya m√°s de 10 a√±os, en los cuales he podido asistir y participar en la mayor√≠a de ellos. Es por ello que es posible

que algunos me conozc√°is ya, aunque me presento por si acaso.</aside></section>
<section data-background-color="#333333" data-transition-speed="default" data-transition="fade" id="sobre-mi-nekmo">
<h2>Sobre m√≠ <strong>Nekmo</strong></h2>
<table class="docutils align-default">
<tbody>
<tr class="row-odd"><td><a class="reference internal image-reference" href="_images/cara.svg"><img alt="_images/cara.svg" src="_images/cara.svg" width="200px" /></a>
<p><em>Programador Python</em></p>
</td>
</tr>
</tbody>
</table>
<aside class="notes">Soy Juan Jos√©, m√°s conocido en redes como Nekmo, y llevo programando en Python ya m√°s de media vida.</aside></section>
<section data-background-color="#333333" data-transition-speed="default" data-transition="fade" id="python">
<h2>Python</h2>
<a class="reference internal image-reference" href="_images/python-logo.png"><img alt="_images/python-logo.png" src="_images/python-logo.png" style="width: 400px;" /></a>
<aside class="notes">Es por ello que es costumbre que hable aqu√≠ de Python, como en esta ocasi√≥n, para qu√© variar. Pero la verdad, llevo
ya varios a√±os pensando en hacer la charla sobre el tema de hoy...</aside></section>
<section>
<section data-background-color="#4973ff" data-transition-speed="default" data-transition="fade" id="decoradores">
<h2>Decoradores</h2>
<pre data-id="decoradores"><code data-trim data-noescape class="python">&#64;decorator
def function():
    pass</code></pre>
<aside class="notes">Porque, ¬øcu√°ntos de vosotros sabr√≠ais explicar claramente qu√© es un decorador? (PAUSA) ¬øy c√≥mo se crean? (PAUSA).
Como imaginaba, mucha gente, a pesar de utilizarlos, no sabr√≠an explicar su funcionamiento, el cual es como una
caja negra.</aside></section>
<section data-background-color="#4e54c8" data-transition-speed="default" data-transition="zoom" id="que-son-los-decoradores">
<h3>¬øQu√© son los <strong>decoradores</strong>?</h3>
<aside class="notes">Pero antes de ello, vamos a ver la definici√≥n oficial de decorador.</aside></section>
<section data-background-color="#4e54c8" data-transition-speed="default" data-transition="slide" id="definicion">
<h3>Definici√≥n</h3>
<p>Definici√≥n</p>
<blockquote>
<div><p>Una funci√≥n que devuelve otra funci√≥n, normalmente aplicando una transformaci√≥n de funci√≥n usando la sintaxis
&#64;wrapper.</p>
<p class="attribution">‚Äî<a class="reference external" href="https://docs.python.org/3/glossary.html">Python.org Glosary</a></p>
</div></blockquote>
<aside class="notes">Seg√∫n la definici√≥n oficial de Python, un decorador es una funci√≥n que devuelve otra funci√≥n, utilizando
habitualmente el nombre @wrapper para la transformaci√≥n. Vale, es posible que esta definici√≥n no os haya aclarado
mucho...</aside></section>
<section data-background-color="#4e54c8" data-auto-animate id="definicion-2">
<h3>Definici√≥n 2</h3>
<p>Definici√≥n</p>
<blockquote>
<div><p>Un decorador es una &quot;funci√≥n&quot; que encapsula a otra &quot;funci√≥n&quot; para modificar o extiender su comportamiento sin modificar
su c√≥digo.</p>
<p class="attribution">‚Äî<a class="reference external" href="https://github.com/Nekmo/decoradores-presentacion/">Yo mismo</a></p>
</div></blockquote>
<aside class="notes">Es por ello, que he preferido traer aqu√≠ esta otra (LEER). La parte clave de esta definici√≥n, es la de encapsular.
Es decir, que la rodea sin alterar su c√≥digo.</aside></section>
<section data-background-color="#4e54c8" data-transition-speed="default" data-auto-animate id="definicion-3">
<h3>Definici√≥n 3</h3>
<p>Definici√≥n</p>
<blockquote>
<div><p>Un decorador es una &quot;funci√≥n&quot; que encapsula a otra &quot;funci√≥n&quot; para modificar o extiender su comportamiento sin modificar
su c√≥digo.</p>
<p class="attribution">‚Äî<a class="reference external" href="https://github.com/Nekmo/decoradores-presentacion/">Yo mismo</a></p>
</div></blockquote>
<pre data-id="definicion-3"><code data-trim data-noescape class="python" data-line-numbers="1-3|1|2-3"> &#64;decorator
 def function():
     pass</code></pre>
<aside class="notes">En este ejemplo de aqu√≠ tenemos un decorador (1) que rodea a una
funci√≥n sin alterar su c√≥digo (2). De esta forma, el decorador ya se est√° aplicando sobre la funci√≥n.</aside></section>
<section data-background-video="_static/gf-tacticalhug.mp4" data-background-video-loop="true" id="abraza">
<h3>Abraza</h3>
<aside class="notes">Podr√≠amos decir, que es como que la abraza, pero no la toca.</aside></section>
<section data-background-color="#4e54c8" data-transition-speed="default" data-transition="slide" id="ejemplos-de-uso">
<h3>Ejemplos de uso</h3>
<ul class="simple">
<li class="fragment"><p>Un decorador <code class="docutils literal notranslate"><span class="pre">&#64;timeit</span></code> que mide el tiempo de ejecuci√≥n de una funci√≥n, sin modificar su c√≥digo.</p></li>
<li class="fragment"><p>Un decorador <code class="docutils literal notranslate"><span class="pre">&#64;retry</span></code> que vuelve a ejecutar una funci√≥n si falla, sin modificar su c√≥digo.</p></li>
<li class="fragment"><p>Un decorador <code class="docutils literal notranslate"><span class="pre">&#64;login_required</span></code> que comprueba si un usuario est√° autenticado, permitiendo s√≥lo la ejecuci√≥n de la
funci√≥n si lo est√°.</p></li>
<li class="fragment"><p>... y <strong>mucho m√°s</strong>.</p></li>
</ul>
<aside class="notes">¬øY para qu√© podemos usar los decoradores? Algunos posibles casos son... (LEER)</aside></section>
<section data-background-color="#4e54c8" data-transition-speed="default" data-transition="zoom" id="y-que-es-esto-del-arroba">
<h3>¬øY qu√© es esto del <strong>arroba</strong>?</h3>
<aside class="notes">Bueno, y puede que os est√©is preguntando, ¬øqu√© es esto del arroba que est√° delante del nombre del decorador?</aside></section>
<section data-background-color="#ffffff" data-background-image="_static/vintage-bg.jpg" data-transition="zoom" id="anotaciones-de-java-1-5">
<h3>Anotaciones de <strong>Java 1.5</strong></h3>
<aside class="notes">Su origen viene de Java 1.5, donde se introdujeron las anotaciones, las cuales eran un uso similar a lo que se
pretend√≠a con los decoradores de Python, y ya utilizaban el s√≠mbolo de arroba. Esto, sumado a que el arroba a√∫n
no estaba siendo utilizado en Python, fue por lo que se decidi√≥ utilizarlo para los decoradores. No obstante, hubo
otras propuestas, como la barra vertical, similar a un pipe.</aside></section>
<section data-background-color="#4e54c8" data-transition-speed="default" data-transition="slide" id="ejecucion-equivalente">
<h3>Ejecuci√≥n <strong>equivalente</strong></h3>
<pre data-id="ejecucion-equivalente"><code data-trim data-noescape class="python" data-line-numbers="1-16|1-7|10-16|15|16"> # Forma con arroba

 &#64;decorator
 def hello_world():
     print(&quot;Hello world!&quot;)

 hello_world()


 # Forma sin arroba

 def hello_world():
     print(&quot;Hello world!&quot;)

 hello_world = decorator(hello_world)
 hello_world()</code></pre>
<aside class="notes">En realidad, el arroba es simplemente az√∫car sint√°ctico. ¬øRecord√°is que dijimos que un decorador es una funci√≥n
que devuelve otra funci√≥n? Pues bien, eso es literalmente lo que hace. As√≠ pues, (1) esta primera forma con el
arroba es equivalente a (2) esta segunda forma sin el arroba. Como pod√©is ver, (3) el decorador recibe como
argumento el nombre de la funci√≥n a decorar, devolviendo una nueva funci√≥n que reemplaza a la original, pero, y
esto es importante, SIN LLAMAR A LA FUNCI√ìN, (4) lo cual se har√° en la √∫ltima l√≠nea, pudi√©ndole pasar los
par√°metros que queramos.</aside></section>
</section>
<section>
<section data-background-color="#4e54c8" data-transition-speed="default" data-transition="slide" id="como-crear-un-decorador">
<h2>C√≥mo <strong>crear</strong> un <strong>decorador</strong></h2>
<aside class="notes">Y ahora que hemos visto c√≥mo aplicarlos, seguramente os est√©is preguntando... ¬øC√≥mo funcionan? Lo mejor para
entenderlo, es creando nosotros uno propio.</aside></section>
<section data-background-color="#4e54c8" data-transition-speed="default" data-transition="slide" id="decorador-basico">
<h3>Decorador <strong>b√°sico</strong></h3>
<pre data-id="decorador-basico"><code data-trim data-noescape class="python" data-line-numbers="1-15|1-8|2-7|1,5|3-4|6-7|8|14|2,15|"> def log(func):
     def wrapper(*args, **kwargs):
         print(f&quot;La funci√≥n {func.__name__} recibir√° los argumentos {args} &quot;
               f&quot;y los par√°metros {kwargs}.&quot;)
         result = func(*args, **kwargs)
         print(f&quot;La funci√≥n {func.__name__} ha devuelto {result}.&quot;)
         return result
     return wrapper

 def hello(word):
     print(f&quot;Hello {word}!&quot;)
     return True

 hello = log(hello)
 hello(&quot;world&quot;)</code></pre>
<aside class="notes">Bien, (1) aqu√≠ tenemos un decorador llamado log, (2) el cual no os asust√©is por tener una funci√≥n dentro de otra.
Esta funci√≥n interior, que llamaremos funci√≥n an√≥nima, es generada din√°micamente por el decorador. (3) Hacemos esto
para que tenga acceso a la funci√≥n original, func, (4) pudiendo hacer cosas antes, (5) o despu√©s de la ejecuci√≥n de
la funci√≥n original. (6) Finalmente devolvemos la funci√≥n an√≥nima SIN LLAMARLA, (7) la cual sustituir√° a hello (8)
y ejecutaremos ya no la funci√≥n hello original, sino la funci√≥n an√≥nima llamada wrapper.</aside></section>
<section data-background-color="#4e54c8" data-transition-speed="default" data-transition="slide" id="resultado">
<h3>Resultado</h3>
<pre data-id="resultado"><code data-trim data-noescape class="python" data-line-numbers="1-3|1|2|3">     La funci√≥n hello recibir√° los argumentos ('word',) y los par√°metros {}.
     Hello word!
     La funci√≥n hello ha devuelto True.</code></pre>
<aside class="notes">Bueno, y por si hab√≠a alguna duda, el decorador (1) mostrar√° esta primera l√≠nea antes de ejecutar func, o lo que
es lo mismo, la funci√≥n hello original, (2) la cual imprimir√° &quot;Hello word!&quot;, ya que no hemos alterado su c√≥digo, (3)
y finalmente el decorador mostrar√° la salida de la funci√≥n original tras su ejecuci√≥n.</aside></section>
<section data-background-video="_static/confused.mp4" data-background-video-loop="true" id="confusion">
<h3>Confusi√≥n</h3>
<aside class="notes">Es posible que todav√≠a est√©is un poco confusos. Es normal. Seguiremos vi√©ndolo mediante ejemplos, aunque vamos
primero a profundizar en la parte que tal vez os sea m√°s complicada, que es la de la funci√≥n an√≥nima.</aside></section>
<section data-background-color="#4e54c8" data-transition-speed="default" data-transition="slide" id="funcion-anonima">
<h3>Funci√≥n <strong>an√≥nima</strong></h3>
<pre data-id="funcion-anonima"><code data-trim data-noescape class="python" data-line-numbers="2-6|2|2-6|1,4|7|9|10|"> def log(func):
     def wrapper(*args, **kwargs):
         ...
         result = func(*args, **kwargs)
         ...
         return result
     return wrapper

 hello_wrapped = log(hello)
 hello_wrapped(&quot;world&quot;)</code></pre>
<aside class="notes">La primera gran duda que surge de esta funci√≥n an√≥nima, (1) es el por qu√© del nombre. Bien, en realidad se podr√≠a
llamar wrapper, o de cualquier otra forma, es s√≥lo una convenci√≥n. (2) ¬øPor qu√© la estamos creando dentro de otra
funci√≥n? (3) Esto es porque queremos que la funci√≥n an√≥nima tenga acceso a la funci√≥n original, llamada func, la
cual tomar√° por contexto (4) ¬øPor qu√© devolvemos wrapped tal cual, en vez de ejecutarlo? (5) Porque queremos que se
devuelva la funci√≥n wrapper tal cual sin ejecutar (6) para que sea ejecutada con los argumentos que le pasemos.</aside></section>
</section>
<section>
<section data-background-color="#4e54c8" data-transition-speed="default" data-transition="slide" id="por-que-se-llaman-decoradores">
<h2>¬øPor qu√© se llaman <strong>decoradores</strong>?</h2>
<aside class="notes">Ahora que ya sabemos crear decoradores, vamos a hacer una peque√±a pausa, tomar un poco de aire, y ver por qu√© se
llaman as√≠. La verdad es que no tiene mucho misterio, ya que se llaman as√≠ por el Patr√≥n de Dise√±o Decorador, que
es similar a lo que hacen los decoradores de Python. A√±adir funcionalidades a un objeto sin modificar su c√≥digo.</aside></section>
<section data-background-color="#4e54c8" data-transition-speed="default" data-transition="slide" id="quejas-sobre-el-nombre">
<h3>Quejas sobre <strong>el nombre</strong></h3>
<p>Cita</p>
<blockquote>
<div><p>Ha habido varias quejas sobre la elecci√≥n del nombre &quot;decorador&quot; para esta funci√≥n.
El principal es que el nombre no concuerda con su uso en el libro de GoF. [...]
<strong>Es muy posible que aparezca un nombre mejor.</strong></p>
<p class="attribution">‚Äî<a class="reference external" href="https://peps.python.org/pep-0318/">PEP 318</a></p>
</div></blockquote>
<aside class="notes">Lo gracioso de esto, es que ya cuando se introdujeron los decoradores en Python hubo quejas sobre el nombre, ya
que no concordaba con el uso del patr√≥n que les da nombre; esto, seg√∫n el principal libro de patrones de dise√±o. Es
por ello, que ya en su d√≠a se dijo que probablemente apareciese un nombre mejor. Spoiler: no ocurri√≥.</aside></section>
</section>
<section>
<section data-background-color="#4e54c8" data-transition-speed="default" data-transition="slide" id="usos-decoradores">
<h2><strong>Usos</strong> decoradores</h2>
<ol class="arabic simple">
<li class="fragment"><p><strong>Alterar</strong> los par√°metros de <strong>entrada</strong> a la funci√≥n.</p></li>
<li class="fragment"><p><strong>Modificar el resultado</strong> de la funci√≥n.</p></li>
<li class="fragment"><p><strong>Condicionar</strong>, <strong>repetir</strong> o <strong>alterar</strong> la forma de ejecuci√≥n de la funci√≥n.</p></li>
<li class="fragment"><p>Realizar <strong>acciones antes</strong> o/y <strong>despu√©s</strong> de la ejecuci√≥n de la funci√≥n.</p></li>
</ol>
<aside class="notes">Vamos a seguir viendo los decoradores mediante algunos ejemplos pr√°cticos, los cuales, seg√∫n su uso, he clasificado
de la siguiente forma (LEER).</aside></section>
<section data-background-color="#4e54c8" data-transition-speed="default" data-transition="slide" id="alterar-parametros-de-entrada">
<h3><strong>Alterar</strong> par√°metros de <strong>entrada</strong></h3>
<pre data-id="alterar-parametros-de-entrada"><code data-trim data-noescape class="python" data-line-numbers="1-5|2|3|4|"> def int_args(func):
     def wrapper(*numbers):
         numbers = [int(number) for number in numbers]
         return func(*numbers)
     return wrapper</code></pre>
<aside class="notes">Aqu√≠ tenemos un primer ejemplo, el cual nos permite alterar los par√°metros de entrada de una funci√≥n decorada,
convirti√©ndolos a enteros. (1) La funci√≥n an√≥nima recibe los par√°metros de la funci√≥n original, (2) los cuales
convierte a enteros (3) antes de llamar a la funci√≥n original con los nuevos par√°metros ya convertidos. Podr√≠a
sernos √∫til si nuestra funci√≥n espera enteros, pero por alguna raz√≥n, los recibe como cadenas.</aside></section>
<section data-background-color="#4e54c8" data-transition-speed="default" data-transition="slide" id="modificar-la-salida-de-la-funcion">
<h3><strong>Modificar la salida</strong> de la funci√≥n</h3>
<pre data-id="modificar-la-salida-de-la-funcion"><code data-trim data-noescape class="python" data-line-numbers="1-5|3|4|"> def response_data(func):
     def wrapper(*args, **kwargs):
         data = func(*args, **kwargs)
         return Response(data=data, status=200)
     return wrapper</code></pre>
<aside class="notes">En este otro ejemplo, el cual nos permite modificar la salida de la funci√≥n, (1) tomamos la salida original, la
cual es una diccionario (2) y la envolvemos en un objeto Response, sin necesidad de modificar la funci√≥n original
para ello.</aside></section>
<section data-background-color="#4e54c8" data-transition-speed="default" data-transition="slide" id="condicionar-la-ejecucion-de-la-funcion">
<h3><strong>Condicionar</strong> la ejecuci√≥n de la funci√≥n</h3>
<pre data-id="condicionar-la-ejecucion-de-la-funcion"><code data-trim data-noescape class="python" data-line-numbers="1-7|3-6|3-4|5-6|1-7"> def is_authenticated(func):
     def wrapper(request):
         if request.user.is_authenticated():
             return func(request)
         else:
             return Response(status=401)
     return wrapper</code></pre>
<aside class="notes">En este otro caso, (1) estamos condicionando la ejecuci√≥n de la funci√≥n original, (2) la cual s√≥lo se ejecutar√°
si el usuario est√° autenticado, (3) devolviendo un error 401 en caso contrario.</aside></section>
<section data-background-color="#4e54c8" data-transition-speed="default" data-transition="slide" id="realizar-acciones-antes-y-despues">
<h3>Realizar <strong>acciones antes</strong> y <strong>despu√©s</strong></h3>
<pre data-id="realizar-acciones-antes-y-despues"><code data-trim data-noescape class="python" data-line-numbers="1-9|3|5-7|"> def timeit(func):
     def wrapper(*args, **kwargs):
         start = time.time()
         result = func(*args, **kwargs)
         end = time.time()
         print(f&quot;La funci√≥n {func.__name__} ha tardado &quot;
               f&quot;{end - start} segundos.&quot;)
         return result
     return wrapper</code></pre>
<aside class="notes">Este otro ejemplo es un caso muy habitual con decoradores, en el cual medimos el tiempo de ejecuci√≥n sin necesidad
de alterar la funci√≥n original. Para ello, (1) medimos el tiempo antes (2) y despu√©s de que se haya ejecutado la
funci√≥n, mostrando el tiempo que ha tardado en ejecutarse.</aside></section>
</section>
<section data-background-color="#4e54c8" data-transition-speed="default" data-transition="slide" id="encadenar-decoradores">
<h2><strong>Encadenar</strong> decoradores</h2>
<pre data-id="encadenar-decoradores"><code data-trim data-noescape class="python" data-line-numbers="1-5|3|2|1|8-9|"> &#64;retry
 &#64;timeit
 &#64;log
 def hello():
     print(&quot;Hello world!&quot;)


# Forma alternativa
hello = retry(timeit(log(hello)))</code></pre>
<aside class="notes">Y puede que os est√©is preguntando, ¬øes posible encadenar varios decoradores? S√≠, por supuesto. Lo √∫nico, tened en
cuenta el orden de aplicaci√≥n, el cual es de abajo (1) (2) (3) hacia arriba. Si lo pens√°is, esto tiene sentido,
ya que estamos encapsulandola en ese orden, meti√©ndo la funci√≥n dentro de otra. (4) Si lo mir√°is de la forma
alternativa, como veis estamos aplicando primero log, luego timeit y finalmente retry, ya que vienen de dentro
hacia fuera.</aside></section>
<section>
<section data-background-color="#4e54c8" data-transition-speed="default" data-transition="slide" id="el-decorador-wraps">
<h2>El decorador <strong>wraps</strong></h2>
<pre data-id="el-decorador-wraps"><code data-trim data-noescape class="python" data-line-numbers="|1-4|6-7|8-9|">&gt;&gt;&gt; &#64;log
&gt;&gt;&gt; def hello_world():
...    &quot;&quot;&quot;Prints 'Hello world!'.&quot;&quot;&quot;
...    print(&quot;Hello world!&quot;)
&gt;&gt;&gt;
&gt;&gt;&gt; print(hello_world.__name__)
'wrapper'
&gt;&gt;&gt; print(hello_world.__doc__)
None</code></pre>
<aside class="notes">Como est√°is viendo, los decoradores son la mar de √∫tiles. Y dentro de Python se utilizan para infinidad de cosas,
entre las cuales, est√° facilitar la creaci√≥n de otros decoradores. El decorador wraps, que veremos a continuaci√≥n,
soluciona uno de los problemas de los decoradores. ¬øRecord√°is que dijimos que el decorador devuelve la funci√≥n
an√≥nima wrapper? Pues bien, uno de los problemas (1) de aplicar un decorador, en este caso log, es que perdemos (2)
el nombre de la funci√≥n original (3) y su documentaci√≥n. ¬øC√≥mo podemos solucionar esto? Pues con el decorador wraps.</aside></section>
<section data-background-color="#4e54c8" data-transition-speed="default" data-transition="slide" id="decorador-wraps">
<h3>Decorador wraps</h3>
<pre data-id="decorador-wraps"><code data-trim data-noescape class="python" data-line-numbers="1-7|1|4|"> from functools import wraps

 def log(func):
     &#64;wraps(func)
     def wrapper(*args, **kwargs):
         ...
     return wrapper</code></pre>
<aside class="notes">Este decorador, (1) que nos viene de la biblioteca est√°ndar en su m√≥dulo functools, (2) nos permite copiar los
metadatos de la funci√≥n original a la funci√≥n an√≥nima, de forma que no perdamos ni su nombre ni su documentaci√≥n.
Es por ello, que os recomiendo que siempre que cre√©is un decorador lo utilic√©is. Si hasta ahora no lo he mostrado,
ha sido s√≥lo por simplificar los ejemplos, pero en la pr√°ctica siempre lo utilizo.</aside></section>
</section>
<section>
<section data-background-color="#000000" data-background-video="_static/surprise.mp4" data-background-video-loop="true" id="no-solo-funciones">
<h2>No s√≥lo <strong>funciones</strong></h2>
<aside class="notes">En realidad, esta no ha sido la √∫nica cosa que os he estado ocultando. ¬øRecord√°is que defin√≠ un decorador como una
funci√≥n que se aplica a una funci√≥n, y lo dije usando &quot;comillas&quot;? Pues bien, esto es una simplificaci√≥n, porque en
realidad se puede aplicar y utilizar en cualquier cosa que sea invocable, que se pueda llamar. No s√≥lo a funciones.</aside></section>
<section data-background-color="#4e54c8" data-transition-speed="default" data-transition="slide" id="aplicado-a-clases">
<h3>Aplicado a <strong>clases</strong></h3>
<pre data-id="aplicado-a-clases"><code data-trim data-noescape class="python" data-line-numbers="1-4|1|3-4|"> &#64;log
 class A:
     def __init__(self):
         print(&quot;Creando una instancia de A.&quot;)</code></pre>
<aside class="notes">Por ejemplo, en este caso, (1) estamos aplicando el decorador log a una clase. Si record√°is este decorador de antes,
imprim√≠a un mensaje antes y despu√©s de la funci√≥n. En nuestro ejemplo, (2) el mensaje se mostrar√° antes y despu√©s
del m√©todo __init__ de la clase A. Tened en cuenta eso s√≠, que la salida de la ejecuci√≥n de  __init__ no ser√° lo que
devuelve la misma, la cual siempre es None, sino la instancia de la clase. Esto podr√≠a utilizarse para hacer cosas
como registrar la creaci√≥n de una instancia, devolver otra instancia en su lugar, o cualquier otra cosa que se os
ocurra.</aside></section>
<section data-background-color="#4e54c8" data-transition-speed="default" data-transition="slide" id="aplicado-a-metodos">
<h3>Aplicado a <strong>m√©todos</strong></h3>
<pre data-id="aplicado-a-metodos"><code data-trim data-noescape class="python" data-line-numbers="1-4|2|3|"> class A:
     &#64;log
     def foo(self):
         print(&quot;Ejecutando foo.&quot;)</code></pre>
<aside class="notes">Por supuesto, (1) tambi√©n podemos aplicar el decorador a m√©todos, comport√°ndose de forma muy similar a como lo
har√≠a con una funci√≥n. (2) Tened en cuenta, que entre los par√°metros que recibe la funci√≥n an√≥nima, se encuentra la
instancia de la clase, la cual se suele llamar self. Esto nos permite acceder a la instancia entera desde el
decorador, para hacer lo que queramos.</aside></section>
<section data-background-color="#4e54c8" data-transition-speed="default" data-transition="slide" id="decorador-creado-usando-una-clase">
<h3><strong>Decorador</strong> creado usando una <strong>clase</strong></h3>
<pre data-id="decorador-creado-usando-una-clase"><code data-trim data-noescape class="python" data-line-numbers="1-13|1-9|2-3|5-9|11-13|">&gt;&gt;&gt; class Log:
...    def __init__(self, func):
...        self.func = func
...
...    def __call__(self, *args, **kwargs):
...        ...
...        result = self.func(*args, **kwargs)
...        ...
...        return result
...
&gt;&gt;&gt; &#64;Log
... def hello_world():
...    print(&quot;Hello world!&quot;)</code></pre>
<aside class="notes">Y por √∫ltimo, tal, y como adelant√© antes, (1) podemos crear un decorador utilizando una clase, ya que la √∫nica
condici√≥n es que sea invocable. En este caso, (2) el init se comporta como la funci√≥n m√°s por fuera del decorador,
(3) y el call como la funci√≥n an√≥nima m√°s por dentro del decorador. Para quienes no lo conozc√°is, el m√©todo m√°gico
call se ejecuta al invocar la instancia de la clase; es decir, cuando utilizamos par√©ntesis despu√©s de ya haber
usado par√©ntesis para instanciar la clase. (4) Y ya como pod√©is ver, se utiliza exactamente igual que los
decoradores que hemos visto hasta ahora.</aside></section>
</section>
<section>
<section data-background-color="#4e54c8" data-transition-speed="default" data-transition="slide" id="decorador-con-argumentos">
<h2>Decorador con <strong>argumentos</strong></h2>
<aside class="notes">Vale, si me hab√©is seguido hasta aqu√≠, ante todo enhorabuena. S√© que son muchas cosas en poco tiempo, y que es
dif√≠cil asimilar tanto en tan poco tiempo. S√≥lo os pido un peque√±o esfuerzo adicional, porque vamos a complicarlo un
poco m√°s. Si hasta ahora puede que os liase un poco la funci√≥n an√≥nima, ahora vamos a a√±adirle una capa adicional.</aside></section>
<section data-background-color="#4e54c8" data-transition-speed="default" data-transition="slide" id="ejemplo-de-decorador-con-argumentos">
<h3>Ejemplo de decorador con argumentos</h3>
<pre data-id="ejemplo-de-decorador-con-argumentos"><code data-trim data-noescape class="python" data-line-numbers="1-3|1|"> &#64;repeat(num_times=5)
 def hello(word):
     print(f&quot;Hello {word}!&quot;)</code></pre>
<aside class="notes">Poder poner par√°metros a un decorador es una necesidad habitual, que no hemos visto hasta el momento. En este
ejemplo el decorador repeat, que nos permitir√° repetir la ejecuci√≥n de la funci√≥n decorada, (1) requiere de un
par√°metro que le dir√° cu√°ntas veces repetir la ejecuci√≥n. De esta manera estamos dando la libertad al usuario de
configurar el decorador.</aside></section>
<section data-background-color="#4e54c8" data-transition-speed="default" data-transition="slide" id="codigo-del-decorador-con-argumentos">
<h3>C√≥digo del decorador con argumentos</h3>
<pre data-id="codigo-del-decorador-con-argumentos"><code data-trim data-noescape class="python" data-line-numbers="1-8|1|4|2-7|3-6|"> def repeat(num_times=3):
     def decorator(func):
         def wrapper(*args, **kwargs):
             for _ in range(num_times):
                 result = func(*args, **kwargs)
             return result
         return wrapper
     return decorator</code></pre>
<aside class="notes">Para ello, necesitamos crear una funci√≥n que nos devuelva de forma din√°mica el decorador con el par√°metro que
queramos. (1) En este caso, el decorador recibe el par√°metro num_times, (2) y estar√° disponible en la funci√≥n
de m√°s adentro. (3) Nuestra funci√≥n crear√° una funci√≥n an√≥nima igual que lo hemos hecho hasta ahora, (4) teniendo
a su vez otra funci√≥n an√≥nima, que si os fij√°is es exactamente igual que la que hemos estado utilizando hasta
ahora. S√© que es un poco lioso, ya que tenemos varias funciones dentro de otras...</aside></section>
<section data-background-color="#4e54c8" data-transition-speed="default" data-transition="slide" id="decorador-con-argumentos-usando-una-clase">
<h3><strong>Decorador</strong> con argumentos usando <strong>una clase</strong></h3>
<pre data-id="decorador-con-argumentos-usando-una-clase"><code data-trim data-noescape class="python" data-line-numbers="1-12|2-3|5-7|9-12|"> class Repeat:
     def __init__(self, num_times=3):
         self.num_times = num_times

     def __call__(self, func):
         self.func = func
         return self.wrapper

     def wrapper(self, *args, **kwargs):
         for _ in range(self.num_times):
             result = self.func(*args, **kwargs)
         return result</code></pre>
<aside class="notes">Es por esto, que en ocasiones puede ser preferible usar una clase, ya que nos permite tener un estado interno y
separar la l√≥gica en diferentes m√©todos. (1) Nuestro init es el equivalente a la funci√≥n m√°s exterior que recibe
la configuraci√≥n del decorador, (2) el call ser√≠a la funci√≥n intermedia, que recibe la funci√≥n a decorar, y (3) el
wrapper ser√≠a la funci√≥n an√≥nima m√°s interna, que recibe los argumentos de la funci√≥n original.</aside></section>
<section data-background-color="#4e54c8" data-transition-speed="default" data-transition="slide" id="decorador-con-parametros-opcionales">
<h3>Decorador con par√°metros <strong>opcionales</strong></h3>
<pre data-id="decorador-con-parametros-opcionales"><code data-trim data-noescape class="python" data-line-numbers="1-8|1-3|6-8|"> &#64;repeat
 def hello(word):
     print(f&quot;Hello {word}!&quot;)


 &#64;repeat(num_times=5)
 def hello(word):
     print(f&quot;Hello {word}!&quot;)</code></pre>
<aside class="notes">Ahora llega la parte m√°s complicada, y os prometo que ser√° la √∫ltima. Con esto, ya sabr√©is todo lo que necesit√°is
saber de los decoradores. S√≥lo os pido un √∫ltimo esfuerzo, porque vamos a ver c√≥mo hacer que los par√°metros del
decorador se puedan poner o no. Aunque esto no es realmente tan importante, a nivel de usuario, es un detalle
que el decorador se pueda utilizar (1) tanto sin definir el par√°metro, como (2) defini√©ndolo. ¬øY estar√©is de acuerdo
que queda m√°s bonito y limpio, no?</aside></section>
<section data-background-color="#4e54c8" data-auto-animate id="con-y-sin-parametros">
<h3><strong>Con</strong> y <strong>sin</strong> par√°metros</h3>
<div class="twocol docutils container">
<div class="leftside docutils container">
<pre><code data-trim data-noescape class="python">def repeat(func):
    def wrapper(*args, **kwargs):
        for _ in range(3):
            result = func(
                *args, **kwargs
            )
        return result
    return wrapper
#
#</code></pre>
</div>
<div class="rightside docutils container">
<pre><code data-trim data-noescape class="python">def repeat(num_times=3):
    def decorator(func):
        def wrapper(*args, **kwargs):
            for _ in range(num_times):
                result = func(
                    *args, **kwargs
                )
            return result
        return wrapper
    return decorator</code></pre>
</div>
</div>
<aside class="notes">Para hacer esto, Python no nos lo pone f√°cil, ya que tenemos que soportar tanto el comportamiento sin par√°metros,
tal y como lo vimos al principio, y que tenemos a la izquierda, como la forma con par√°metros, que est√° a la derecha.
La diferencia principal entre ambos c√≥digos, como pod√©is ver, es que a la izquierda tenemos 2 funciones anidadas, y
a la derecha 3.</aside></section>
<section data-background-color="#4e54c8" data-transition-speed="default" data-transition="slide" id="condicionar-parametros">
<h3><strong>Condicionar</strong> par√°metros</h3>
<pre data-id="condicionar-parametros"><code data-trim data-noescape class="python" data-line-numbers="1-8|1,4|2,3,5|1,6|2,3,7|"> def repeat(_func=None, num_times=3):
     def decorator(func):
         ...
     if _func is None:
         return decorator
     else:
         return decorator(_func)</code></pre>
<aside class="notes">Para ello, tenemos que hacer un peque√±o hack, tenemos que saber en qu√© situaci√≥n estamos de las dos anteriores.
(1) Si NO nos est√°n pasando directamente la funci√≥n a decorar, es porque se est√° pasando el par√°metro num_times,
estamos en la situaci√≥n con 3 funciones anidadas. (2) En tal caso devolvemos el decorador. (3) Si nos est√°n pasando
la funci√≥n, tendremos el par√°metro num_times por defecto; estamos en la situaci√≥n con 2 funciones anidadas. (4) En
tal caso, el truco que usamos es saltarnos un nivel de anidamiento llamando directamente al decorador con la
funci√≥n a decorar.</aside></section>
<section data-background-color="#4e54c8" data-transition-speed="default" data-transition="slide" id="codigo-completo-decorador-con-parametros-opcionales">
<h3>C√≥digo completo decorador con par√°metros opcionales</h3>
<pre data-id="codigo-completo-decorador-con-parametros-opcionales"><code data-trim data-noescape class="python" data-line-numbers="1-11"> def repeat(_func=None, num_times=3):
     def decorator(func):
         def wrapper(*args, **kwargs):
             for _ in range(num_times):
                 result = func(*args, **kwargs)
             return result
         return wrapper
     if _func is None:
         return decorator
     else:
         return decorator(_func)</code></pre>
<aside class="notes">El c√≥digo ya completo ser√≠a el siguiente. Como veis tenemos las 3 funciones anidadas, y el peque√±o hack para
saltarnos un nivel de anidamiento si nos est√°n pasando la funci√≥n a decorar.</aside></section>
<section data-background-color="#4e54c8" data-transition-speed="default" data-transition="slide" id="codigo-decorador-con-parametros-opcionales-usando-una-clase">
<h3>C√≥digo decorador con par√°metros opcionales usando una clase</h3>
<pre data-id="codigo-decorador-con-parametros-opcionales-usando-una-clase"><code data-trim data-noescape class="python" data-line-numbers="1-16|2-4|6-11"> class Repeat:
     def __init__(self, func=None, num_times=3):
         self.func = func
         self.num_times = num_times

     def __call__(self, *args, **kwargs):
         if self.func is None:
             self.func = args[0]
             return self.wrapper
         else:
             return self.wrapper(*args, **kwargs)

     def wrapper(self, *args, **kwargs):
         for _ in range(self.num_times):
             result = self.func(*args, **kwargs)
         return result</code></pre>
<aside class="notes">Por supuesto, tambi√©n lo podemos hacer usando una clase, aunque el c√≥digo es un poco diferente. (1) Ya que no
podemos poner la condici√≥n de nuestro hack en el init, ya que un init no puede devolver nada, (2) por ello lo
ponemos en el call, donde decidimos si estamos en la situaci√≥n con 2 funciones anidadas o con 3 en funci√≥n de si nos
vino la funci√≥n en el init o no.</aside></section>
</section>
<section data-background-color="#000000" data-background-video="_static/applause.mp4" data-background-video-loop="true" id="expertos-en-decoradores">
<h2><strong>Expertos</strong> en decoradores</h2>
<aside class="notes">Ahora, y por fin, con esto ya sab√©is todo que quer√≠ais saber sobre decoradores, y lo que no. ¬°Ya os pod√©is
considerar unos expertos!</aside></section>
<section data-background-gradient="linear-gradient(-45deg, #ee7752, #e73c7e, #23a6d5, #23d5ab);" id="muchas-gracias-a-todos">
<h2>¬°Muchas gracias a todos!</h2>
<aside class="notes">¬°Muchas gracias a todos por llegar hasta aqu√≠!</aside></section>
<section>
<section data-background-color="#4973ff" data-transition-speed="default" data-transition="none" id="codigo-qr">
<h2>C√≥digo QR</h2>
<a class="reference internal image-reference" href="_images/qr.png"><img alt="QR" class="align-center" src="_images/qr.png" style="width: 600px;" /></a>
<aside class="notes">Si quer√©is, ten√©is disponible la presentaci√≥n con su c√≥digo fuente en GitHub, donde ten√©is todos los ejemplos de
c√≥digo para probarlos en casa. Adem√°s junto a las diapositivas se encuentran las notas, para que pod√°is repasarlas
con m√°s tiempo.</aside></section>
<section data-background-color="#333333" data-transition="none" data-transition-speed="slow" id="contactar">
<h3>Contactar</h3>
<ul class="simple">
<li><p>üåê <strong>Sitio web:</strong> <a class="reference external" href="https://nekmo.com">nekmo.com</a></p></li>
<li><p>üì´ <strong>Email:</strong> <a class="reference external" href="mailto:contacto&#37;&#52;&#48;nekmo&#46;com">contacto<span>&#64;</span>nekmo<span>&#46;</span>com</a></p></li>
<li><p>üê¶ <strong>Twitter:</strong> <a class="reference external" href="https://twitter.com/nekmocom">&#64;nekmocom</a></p></li>
<li><p>üì± <strong>Telegram:</strong> <a class="reference external" href="https://t.me/nekmo">&#64;nekmo</a></p></li>
<li><p>üí° <strong>Jabber:</strong> <a class="reference external" href="xmpp://nekmo&#64;nekmo.org">nekmo&#64;nekmo.org</a></p></li>
</ul>
<aside class="notes">Y tambi√©n, si ten√©is alguna duda, aqu√≠ ten√©is mis formas de contacto.</aside></section>
</section>

        </div>
    </div>
    
    <script src="_static/revealjs4/dist/reveal.js"></script>
    
    
      <script src="_static/revealjs4/plugin/notes/notes.js"></script>
      <script src="_static/revealjs4/plugin/highlight/highlight.js"></script>
      
    
    <script>
        var revealjsConfig = new Object();
        Object.assign(revealjsConfig, 
    {
        controls: true,
        progress: true,
        history: true,
        center: true,
        margin: 0.2,        
        transition: "slide",
    }
);
        
        
        
          revealjsConfig.plugins = [
            RevealNotes,RevealHighlight,
          ];
        
        // More info https://github.com/hakimel/reveal.js#configuration
        Reveal.initialize(revealjsConfig);
    </script>

  </body>
</html>